name: Hourly Weather Report to Telegram

on:
  schedule:
    # æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼ˆUTCæ—¶é—´ï¼‰
    - cron: '0 * * * *'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  send-weather:
    runs-on: ubuntu-latest
    
    steps:
    - name: Send Weather Report to Telegram
      env:
        BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        # è·å–å¤©æ°”æ•°æ®
        SH=$(curl -s --max-time 30 "wttr.in/Shanghai?format=ğŸ“+ä¸Šæµ·:+%c+%t(ä½“æ„Ÿ+%f),%wé£,%hæ¹¿åº¦" 2>/dev/null || echo "ğŸ“ ä¸Šæµ·: è·å–å¤±è´¥")
        TZ=$(curl -s --max-time 30 "wttr.in/Tongzhou?format=ğŸ“+æ±Ÿè‹é€šå·:+%c+%t(ä½“æ„Ÿ+%f),%wé£,%hæ¹¿åº¦" 2>/dev/null || echo "ğŸ“ æ±Ÿè‹é€šå·: è·å–å¤±è´¥")
        TJ=$(curl -s --max-time 30 "wttr.in/Taojiang?format=ğŸ“+æ¹–å—æ¡ƒæ±Ÿ:+%c+%t(ä½“æ„Ÿ+%f),%wé£,%hæ¹¿åº¦" 2>/dev/null || echo "ğŸ“ æ¹–å—æ¡ƒæ±Ÿ: è·å–å¤±è´¥")
        
        # è·å–å½“å‰æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
        TIME=$(date -d '+8 hours' '+%H:%M')
        
        # æ„å»ºæ¶ˆæ¯
        MESSAGE="ğŸŒ¤ï¸ å¤©æ°”é¢„æŠ¥ ${TIME}

${SH}
${TZ}
${TJ}

---
â° æ¯å°æ—¶è‡ªåŠ¨æ›´æ–° Â· æ•°æ®æ¥è‡ª wttr.in"
        
        # å‘é€åˆ° Telegram
        curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
          -d "chat_id=${CHAT_ID}" \
          -d "text=${MESSAGE}"
        
        echo "Weather report sent at ${TIME}"
